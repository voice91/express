/**
 * This file is generated by Appinvento, also it can be overwritten by Appinvento.
 * Only fields name will be overwritten, if the field name will be changed.
 */
import Joi from 'joi';
import enumFields from 'models/enum.model';
import config from '../../config/config';

export const register = {
  body: Joi.object()
    .keys({
      // Common fields for the registration process
      email: Joi.string().email(),
      password: Joi.string(),
      firstName: Joi.string(),
      lastName: Joi.string(),
      phoneNumber: Joi.string(),
      companyName: Joi.string(),
      companyAddress: Joi.string(),
      role: Joi.string().valid(...Object.values(enumFields.EnumRoleOfUser)),
      city: Joi.string(),
      state: Joi.string().valid(...Object.values(enumFields.EnumStatesOfDeal)),
      zipcode: Joi.number().integer().min(10000).max(99999),
      emailPresentingPostmark: Joi.bool().default(false),
      isRedirectedFromSendDeal: Joi.bool(),
    })
    // Condition: Check if isRedirectedFromSendDeal exists in the request body
    .when(Joi.object({ isRedirectedFromSendDeal: Joi.exist() }).unknown(), {
      // If the condition is met (isRedirectedFromSendDeal exists)
      then: Joi.object({
        email: Joi.string().required().email(),
        password: Joi.string().required(),
      }),
      // If the condition is not met (isRedirectedFromSendDeal doesn't exist)
      otherwise: Joi.object({
        email: Joi.string().required().email(),
        password: Joi.string().required(),
        firstName: Joi.string().required(),
        lastName: Joi.string().required(),
        companyName: Joi.string().required(),
        city: Joi.string(),
        state: Joi.string().valid(...Object.values(enumFields.EnumStatesOfDeal)),
        zipcode: Joi.number().integer().min(10000).max(99999),
      }),
    }),
};

export const login = {
  body: Joi.object().keys({
    email: Joi.string().required(),
    password: Joi.string().required(),
    deviceToken: Joi.string().allow(''),
    platform: Joi.string().valid(...Object.values(enumFields.EnumPlatformOfDeviceToken)),
  }),
};

/**
 * When User is loggedIn using social login for the first time, then he can enforce his password
 * @type {{body: Joi.ObjectSchema<any>}}
 */
export const enforcePassword = {
  body: Joi.object().keys({
    password: Joi.string().required(),
  }),
};

export const verifyEmail = {
  query: Joi.object().keys({
    token: Joi.string().required(),
  }),
};
export const sendVerifyEmail = {
  body: Joi.object().keys({
    email: Joi.string().email().required(),
  }),
};

/**
 * validation for sending forgot password email to the user
 */
export const forgotPassword = {
  body: Joi.object().keys({
    email: Joi.string().email().required(),
  }),
};

/**
 * validation for setting the new password
 */
export const resetPassword = {
  body: Joi.object().keys({
    password: Joi.string().required(),
    email: Joi.string().email().required(),
    code: Joi.string().length(config.jwt.resetPasswordCodeSize).required(),
  }),
};
